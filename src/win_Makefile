################################################################################
# @file makefile
# 
# @author Nathan Hui, nthui@eng.ucsd.edu
# 
# @description
# UI Board FW Makefile.  This makefile expects GNU Make and GCC
# 
# This program is free software: you can redistribute it and/or modify it under
# the terms of the GNU general Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later
# version.
# 
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
# FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more 
# details.
# 
# You should have received a copy of the GNU General Public License along with
# this program.  If not, see <http://www.gnu.org/licenses/>
# 
# 
# DATE      WHO DESCRIPTION
# -----------------------------------------------------------------------------
# 08/23/20  NH  Added additional warnings, removed main target
# 08/09/20  NH  Added all, fixed simulation build objects
# 08/07/20  NH  Added UIB simulation build
# 07/02/20  NH  Rename to Makefile, added dependency checking
# 07/01/20  NH  Initial Commit
# 
################################################################################

CC=gcc
SRCS = main.c nmea.c voltage_sim.c compass_sim.c sensor_encoder.c status_decoder.c sensor_module.c LED_module.c uibWinBuild.c serial_sim.c
CFLAGS = -std=gnu11 -c -g -Wall -Wextra -Wabi=11 -Wformat -Wformat-nonliteral -Wformat-signedness
LDLIBS = -lpthread

SIM_OBJS = compass_sim.o voltage_sim.o serial_sim.o

TEST_OBJS = sensor_encoder.o status_decoder.o sensor_module.o LED_module.o

DEPDIR := .deps
DEPFLAGS = -MT $@ -MMD -MP -MF $(DEPDIR)/$*.d

COMPILE.c = $(CC) $(DEPFLAGS) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c


.PHONY: clean all

all: uibWinBuild

uibWinBuild: uibWinBuild.o nmea.o $(SIM_OBJS) $(TEST_OBJS)

%.o : %.c
%.o : %.c $(DEPDIR)/%.d | $(DEPDIR)
	$(COMPILE.c) $(OUTPUT_OPTION) $<

clean:
	touch gps_in obc_in obc_out
	-rm -f *.o uibWinBuild

sim-clean:
	touch gps_in gps_out obc_in obc_out
	-rm -f *.o uibWinBuild gps_in gps_out obc_in obc_out gps.bin compassSim

$(DEPDIR): ; @mkdir -p $@

DEPFILES := $(SRCS:%.c=$(DEPDIR)/%.d)
$(DEPFILES):

include $(wildcard $(DEPFILES))